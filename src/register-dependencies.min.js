/*global 
    g_MinimalDownload 
    RegisterModuleInit 
    RegisterSod
    RegisterSodDep
    ListModule
*/
/*eslint no-unused-vars: ["error", { "varsIgnorePattern": "replaceUrlTokens" }]*/

/*
 * http://www.eliostruyf.com/correctly-including-scripts-display-templates/
 *
*/
(function() {
    // Is MDS enabled?
    if ('undefined' != typeof g_MinimalDownload && g_MinimalDownload && (window.location.pathname.toLowerCase()).endsWith('/_layouts/15/start.aspx') && 'undefined' != typeof asyncDeltaManager) {
        // Register script for MDS if possible
        RegisterModuleInit('init.js', init); //MDS registration
    }

    init();

    function init () {
        // Register libs.
        RegisterSod('jquery-2.2.0.min.js', 'https://code.jquery.com/jquery-2.2.0.min.js');
        RegisterSod('jquery-ui-1.12.min.js', 'https://code.jquery.com/ui/1.12.0-beta.1/jquery-ui.min.js');
        RegisterSod('datatables-1.10.11.min.js', 'https://cdn.datatables.net/1.10.11/js/jquery.dataTables.min.js');
        RegisterSod('sieve-0.3.0.min.js', 'http://rmm5t.github.com/jquery-sieve/dist/jquery.sieve.min.js');
        // RegisterSod('script1.js', replaceUrlTokens('~sitecollection/_catalogs/masterpage/tests/script1.js'));

        // Register dependencies.
        RegisterSodDep('jquery-ui-1.12.min.js', 'jquery-2.2.0.min.js');
        RegisterSodDep('sieve-0.3.0.min.js', 'jquery-2.2.0.min.js');
    }

    // Utils
    // Copied from: SPClientRenderer.ReplaceUrlTokens.
    function replaceUrlTokens (a) {
        if (ListModule.Settings.SupportsUrlTokenReplacement) {
            var c = window._spPageContextInfo;
            if (a == null || a == '' || c == null) return '';
            var k = '~site/',
                f = '~sitecollection/',
                e = '~sitecollectionmasterpagegallery/',
                b = a.toLowerCase();
            if (b.indexOf(k) == 0) {
                var n = h(c.webServerRelativeUrl);
                a = n + a.substr(k.length);
                b = n + b.substr(k.length);
            } else if (b.indexOf(f) == 0) {
                var m = h(c.siteServerRelativeUrl);
                a = m + a.substr(f.length);
                b = m + b.substr(f.length);
            } else if (b.indexOf(e) == 0) {
                var l = h(c.siteServerRelativeUrl);
                a = l + '_catalogs/masterpage/' + a.substr(e.length);
                b = l + '_catalogs/masterpage/' + b.substr(e.length);
            }
            var j = '{lcid}',
                i = '{locale}',
                g = '{siteclienttag}',
                d = -1;
            while ((d = b.indexOf(j)) != -1) {
                a = a.substring(0, d) + String(c.currentLanguage) + a.substr(d + j.length);
                b = b.replace(j, String(c.currentLanguage));
            }
            while ((d = b.indexOf(i)) != -1) {
                a = a.substring(0, d) + c.currentUICultureName + a.substr(d + i.length);
                b = b.replace(i, c.currentUICultureName);
            }
            while ((d = b.indexOf(g)) != -1) {
                a = a.substring(0, d) + c.siteClientTag + a.substr(d + g.length);
                b = b.replace(g, c.siteClientTag);
            }
            return a;
        }
        return '';

        function h (a) {
            if (a == null || a == '') return '';
            var b = a.length;
            return a[b - 1] == '/' ? a : a + '/';
        }
    }
}());

/*
// https://msdn.microsoft.com/en-us/library/office/ff409592(v=office.14).aspx
// Register this file as a site-wide custom action.
// Set up your dependencies and then call them on
// demand using this code.  Be sure to define the
// second parameter, else the callback only fires
// once, and that's no good.

EnsureScriptFunc('jquery-ui-1.12.min.js', '$.ui', function() {
    console.log('jquery-ui loaded');
});

*/